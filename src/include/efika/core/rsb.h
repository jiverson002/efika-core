/* SPDX-License-Identifier: MIT */
#ifndef EFIKA_CORE_RSB_H
#define EFIKA_CORE_RSB_H 1

#include <limits.h>
#include <stdbool.h>

#include "efika/core.h"

#include "efika/core/rename.h"

/*----------------------------------------------------------------------------*/
/*! */
/*----------------------------------------------------------------------------*/
static ind_t const RSB_SHIFT = sizeof(ind_t) * CHAR_BIT / 2;

/*----------------------------------------------------------------------------*/
/*! */
/*----------------------------------------------------------------------------*/
static ind_t const RSB_SIZE = (ind_t)1 << RSB_SHIFT;

/*----------------------------------------------------------------------------*/
/*! */
/*----------------------------------------------------------------------------*/
static ind_t const RSB_MASK = RSB_SIZE - 1;

/*----------------------------------------------------------------------------*/
/*! */
/*----------------------------------------------------------------------------*/
__attribute__((unused)) static inline ind_t
RSB_row(ind_t const x)
{
  return x >> RSB_SHIFT;
}

/*----------------------------------------------------------------------------*/
/*! */
/*----------------------------------------------------------------------------*/
__attribute__((unused)) static inline ind_t
RSB_col(ind_t const x)
{
  return x & RSB_MASK;
}

/*----------------------------------------------------------------------------*/
/*! */
/*----------------------------------------------------------------------------*/
__attribute__((unused)) static inline ind_t
RSB_idx(ind_t const r, ind_t const c)
{
  return r << RSB_SHIFT | c;
}

/*----------------------------------------------------------------------------*/
/*! */
/*----------------------------------------------------------------------------*/
__attribute__((unused)) static inline bool
RSB_is_split(ind_t const n)
{
  return n > RSB_SIZE;
}

/*----------------------------------------------------------------------------*/
/*! */
/*----------------------------------------------------------------------------*/
__attribute__((unused)) static inline ind_t
RSB_sa_size(ind_t const n)
{
  return !RSB_is_split(n) ? 0 : (n / RSB_SIZE) * (n / RSB_SIZE) - 1;
}

#endif /* EFIKA_CORE_RSB_H */
